2025-10-09 10:45:35,347 - __main__ - INFO - üöÄ Starting transaction debug session...
2025-10-09 10:45:35,347 - __main__ - INFO - ============================================================
2025-10-09 10:45:36,976 - __main__ - INFO - ‚úÖ Database connection successful: Connected successfully to PostgreSQL: PostgreSQL 17.6 on aarch64-unknown-linux-gnu, comp...
2025-10-09 10:45:36,976 - __main__ - INFO - üîç Checking current database state...
2025-10-09 10:45:37,849 - __main__ - INFO - Checking if status column exists...
2025-10-09 10:45:37,966 - __main__ - INFO - ‚úÖ Status column exists: {'column_name': 'status', 'data_type': 'USER-DEFINED', 'is_nullable': 'NO', 'column_default': "'pending'::transaction_status"}
2025-10-09 10:45:37,967 - __main__ - INFO - Fetching all transactions...
2025-10-09 10:45:38,023 - __main__ - INFO - Found 8 recent transactions:
2025-10-09 10:45:38,023 - __main__ - INFO -   ID 10: Major Airlines $1250.00 - pending
2025-10-09 10:45:38,023 - __main__ - INFO -     Notes: Flight to New York (Booking ref: XYZ789)
2025-10-09 10:45:38,023 - __main__ - INFO -   ID 9: Local Coffee Shop $45.50 - approved
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: Morning coffee run
2025-10-09 10:45:38,024 - __main__ - INFO -   ID 6: Internal Transfer $200.00 - pending
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: Transfer to savings
2025-10-09 10:45:38,024 - __main__ - INFO -   ID 2: Supermart $82.10 - declined
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: Extra supplies
TEST: Streamlit function simulation
2025-10-09 10:45:38,024 - __main__ - INFO -   ID 1: Local Grocery $45.23 - declined
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: Weekly groceries
TEST: Cancellation function test
2025-10-09 10:45:38,024 - __main__ - INFO -   ID 3: Cafe Corner $15.00 - declined
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: Coffee and sandwich
TEST: Fixed function test
2025-10-09 10:45:38,024 - __main__ - INFO -   ID 5: Gadget Store $350.00 - pending
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: New headphones
2025-10-09 10:45:38,024 - __main__ - INFO -   ID 4: Electric Co $120.00 - declined
2025-10-09 10:45:38,024 - __main__ - INFO -     Notes: Monthly bill
TEST: Fixed SQL syntax
2025-10-09 10:45:38,024 - __main__ - INFO - Status breakdown: {'pending': 3, 'approved': 1, 'declined': 4}
2025-10-09 10:45:38,024 - __main__ - INFO - Looking for gadget store transactions...
2025-10-09 10:45:38,079 - __main__ - INFO - Found 1 gadget/electronics related transactions:
2025-10-09 10:45:38,079 - __main__ - INFO -   ID 5: Gadget Store $350.00 - pending
2025-10-09 10:45:38,079 - __main__ - INFO -     Notes: New headphones
2025-10-09 10:45:38,132 - __main__ - INFO - üîß Testing raw SQL update operations...
2025-10-09 10:45:39,148 - __main__ - INFO - ‚úÖ Created test transaction 11
2025-10-09 10:45:39,149 - __main__ - INFO - Attempting to update transaction 11...
2025-10-09 10:45:39,258 - __main__ - INFO - Update affected 1 rows
2025-10-09 10:45:39,419 - __main__ - INFO - Updated transaction: {'transaction_id': 11, 'status': 'declined', 'notes': 'Raw SQL test\nRaw SQL test update'}
2025-10-09 10:45:39,419 - __main__ - INFO - ‚úÖ Raw SQL update successful!
2025-10-09 10:45:39,470 - __main__ - INFO - üß™ Testing transaction cancellation operation...
2025-10-09 10:45:39,471 - db_utils - INFO - üìã GET_PENDING_TRANSACTIONS: Starting to fetch pending transactions...
2025-10-09 10:45:40,348 - db_utils - DEBUG - ‚úÖ Database connection established for pending transactions query
2025-10-09 10:45:40,456 - db_utils - INFO - üìä Found 3 pending transactions
2025-10-09 10:45:40,457 - db_utils - DEBUG -    - ID 10: Major Airlines $1250.00 (pending)
2025-10-09 10:45:40,457 - db_utils - DEBUG -    - ID 6: Internal Transfer $200.00 (pending)
2025-10-09 10:45:40,457 - db_utils - DEBUG -    - ID 5: Gadget Store $350.00 (pending)
2025-10-09 10:45:40,510 - __main__ - INFO - Found 3 pending transactions
2025-10-09 10:45:40,510 - __main__ - INFO - üéØ Testing cancellation of transaction 10: Major Airlines $1250.00
2025-10-09 10:45:41,479 - __main__ - INFO - BEFORE cancellation: {'transaction_id': 10, 'merchant': 'Major Airlines', 'amount': Decimal('1250.00'), 'status': 'pending', 'notes': 'Flight to New York (Booking ref: XYZ789)'}
2025-10-09 10:45:41,534 - __main__ - INFO - Attempting cancellation...
2025-10-09 10:45:41,535 - db_utils - INFO - üéØ CANCEL_TRANSACTION: Starting cancellation for transaction 10
2025-10-09 10:45:41,535 - db_utils - INFO -    Reason: Debug test cancellation
2025-10-09 10:45:41,535 - db_utils - DEBUG - Creating database connection...
2025-10-09 10:45:42,407 - db_utils - DEBUG - ‚úÖ Database connection established
2025-10-09 10:45:42,407 - db_utils - DEBUG - Starting database transaction...
2025-10-09 10:45:42,408 - db_utils - DEBUG - ‚úÖ Database transaction started
2025-10-09 10:45:42,408 - db_utils - DEBUG - Checking if transaction 10 exists and is pending...
2025-10-09 10:45:42,518 - db_utils - DEBUG - Query result: {'transaction_id': 10, 'status': 'pending', 'merchant': 'Major Airlines', 'amount': Decimal('1250.00'), 'notes': 'Flight to New York (Booking ref: XYZ789)'}
2025-10-09 10:45:42,518 - db_utils - INFO - üìä Found transaction: Major Airlines $1250.00 (status: pending)
2025-10-09 10:45:42,518 - db_utils - INFO - üîÑ Updating transaction 10 status to 'declined'...
2025-10-09 10:45:42,518 - db_utils - DEBUG - Adding cancellation reason: CANCELLED: Debug test cancellation
2025-10-09 10:45:42,581 - db_utils - INFO - üìà Update query affected 1 rows
2025-10-09 10:45:42,581 - db_utils - INFO - üíæ Committing transaction...
2025-10-09 10:45:42,639 - db_utils - INFO - ‚úÖ TRANSACTION SUCCESSFULLY CANCELLED!
2025-10-09 10:45:42,640 - db_utils - DEBUG - Verifying the cancellation...
2025-10-09 10:45:42,747 - db_utils - INFO - ‚úÖ Verification: Transaction 10 now has status 'declined'
2025-10-09 10:45:42,748 - db_utils - DEBUG -    Updated notes: Flight to New York (Booking ref: XYZ789)
CANCELLED: Debug test cancellation
2025-10-09 10:45:42,748 - db_utils - INFO - üéâ Transaction 10 (Major Airlines: $1250.00) successfully cancelled
2025-10-09 10:45:42,800 - __main__ - INFO - Cancellation result: success=True, message='Transaction 10 (Major Airlines: $1250.00) successfully cancelled'
2025-10-09 10:45:43,810 - __main__ - INFO - AFTER cancellation: {'transaction_id': 10, 'merchant': 'Major Airlines', 'amount': Decimal('1250.00'), 'status': 'declined', 'notes': 'Flight to New York (Booking ref: XYZ789)\nCANCELLED: Debug test cancellation'}
2025-10-09 10:45:43,811 - __main__ - INFO - ‚úÖ Status changed from 'pending' to 'declined'
2025-10-09 10:45:43,811 - __main__ - INFO - ‚úÖ Notes updated: 'Flight to New York (Booking ref: XYZ789)
CANCELLED: Debug test cancellation'
2025-10-09 10:45:43,870 - __main__ - INFO - üéâ All debug tests completed!
2025-10-09 10:45:43,870 - __main__ - INFO - Check transaction_debug.log for detailed logs
